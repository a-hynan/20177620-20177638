<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
    <title>ğŸŒ³å­¦æ ‘ğŸŒ³</title>
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	 <link rel="stylesheet" href="css/customcss.css" rel="stylesheet" type="text/css"/>
<style>
 .node {
        cursor: pointer;
        
    }
    .node circle {
      fill: #ae3258;
      stroke: #b48793;
      stroke-width: 3px;
    }
    .node rect {
      fill: #ae3258;
      stroke: #caa4b9;
      stroke-width: 1.5px;
      transition: all 0.5s;
    }
    .node text {
      font: 10px sans-serif;
    }

    .link {
      fill: none;
      stroke: #FFCCCC;
      stroke-width: 3px;
    }
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
  background-color:rgb(248,248,248) ;
  padding: 20px;
  text-align: center;
}
</style>
<body background="13.jpg" style=" background-repeat:no-repeat ;background-size:100% 100%;
background-attachment: fixed;">

</head>

<body>
<nav class="navbar navbar-inverse" role="navigation">
	<div class="container-fluid">
    <div class="navbar-header">
        <a class="navbar-brand" href="#">å­¦æ ‘</a>
    </div>
    <div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="#">å®¶æ—æ ‘</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        è®¾ç½® <b class="caret"></b>
                </a>
                
                <ul class="dropdown-menu">
                    <li><a href='person.jsp'"/">ä¸ªäººä¿¡æ¯</a></li>
                    <li><a href="#">å¯¼å¸ˆä¿¡æ¯</a></li>
                    <li><a href="#">é€€å‡º</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
<div class="header">
  <h1>Wellcome Studytree!</h1>
</div>
  
	<!-- load the d3.js library -->
	<script src="http://d3js.org/d3.v3.min.js"></script>

	<script>
        //jsonæ¥å£
        var treeData = [{
            "name": "",
            "parent": "",
            "children": [{
                "name": "",
                "parent": "",
                "children": [{
                    "name": "",
                    "parent": ""
                }, {
                    "name": "",
                    "parent": "",
                    "children": [{
                        "name": "",
                        parent: ""
                    }]
                }, {
                    "name": "",
                    "parent": ""
                }, {
                    "name": "",
                    "parent": ""
                }]
            }, {
               
					"name" : "",
							"parent" : "",
							"children" : [ {
								"name" : "",
								"parent" : ""
							}, {
								"name" : "",
								"parent" : ""
							}, ]

						}, {
							"name" : "",
							"parent" : ""
						}, ]
					} ];

					// ************** Generate the tree diagram  *****************
					/*------------*/
					//var j;
					/*------------*/
					/*------------------åˆå§‹åŒ–å‡½æ•°å¼€å§‹--------------------*/
					function shuInit(tree_num) { //ç”»ç¬¬tree_numæ£µæ ‘
						//å®šä¹‰æ ‘å›¾çš„å…¨å±€å±æ€§ï¼ˆå®½é«˜ï¼‰
						var margin = {
							top : 20,
							right : 120,
							bottom : 20,
							left : 120
						}, width = 960 - margin.right - margin.left, height = 1000
								- margin.top - margin.bottom;

						var i = 0, duration = 750, //è¿‡æ¸¡å»¶è¿Ÿæ—¶é—´
						root;

						var tree = d3.layout.tree() //åˆ›å»ºä¸€ä¸ªæ ‘å¸ƒå±€
						.size([ height, width ]);

						var diagonal = d3.svg.diagonal().projection(
								function(d) {
									return [ d.y, d.x ];
								}); //åˆ›å»ºæ–°çš„æ–œçº¿ç”Ÿæˆå™¨

						//å£°æ˜ä¸å®šä¹‰ç”»å¸ƒå±æ€§
						var svg = d3.select("body").append("svg").attr("width",
								width + margin.right + margin.left).attr(
								"height", height + margin.top + margin.bottom)
								.append("g").attr(
										"transform",
										"translate(" + margin.left + ","
												+ margin.top + ")");

						root = treeData[tree_num]; //treeDataä¸ºä¸Šè¾¹å®šä¹‰çš„ç¬¬tree_numæ£µæ ‘èŠ‚ç‚¹å±æ€§
						root.x0 = height / 2;
						root.y0 = 0;

						update(root);

						d3.select(self.frameElement).style("height", "500px");

						function update(source) {
							// Compute the new tree layout.è®¡ç®—æ–°æ ‘å›¾çš„å¸ƒå±€
							var nodes = tree.nodes(root).reverse(), links = tree
									.links(nodes);

							// Normalize for fixed-depth.è®¾ç½®yåæ ‡ç‚¹ï¼Œæ¯å±‚å 180px
							nodes.forEach(function(d) {
								d.y = d.depth * 180;
							});

							// Update the nodesâ€¦æ¯ä¸ªnodeå¯¹åº”ä¸€ä¸ªgroup
							var node = svg.selectAll("g.node").data(nodes,
									function(d) {
										return d.id || (d.id = ++i);
									}); //data()ï¼šç»‘å®šä¸€ä¸ªæ•°ç»„åˆ°é€‰æ‹©é›†ä¸Šï¼Œæ•°ç»„çš„å„é¡¹å€¼åˆ†åˆ«ä¸é€‰æ‹©é›†çš„å„å…ƒç´ ç»‘å®š

							// Enter any new nodes at the parent's previous position.æ–°å¢èŠ‚ç‚¹æ•°æ®é›†ï¼Œè®¾ç½®ä½ç½®
							var nodeEnter = node.enter().append("g") //åœ¨ svg ä¸­æ·»åŠ ä¸€ä¸ªgï¼Œgæ˜¯ svg ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œæ˜¯ group çš„æ„æ€ï¼Œå®ƒè¡¨ç¤ºä¸€ç»„ä»€ä¹ˆä¸œè¥¿ï¼Œå¦‚ä¸€ç»„ lines ï¼Œ rects ï¼Œcircles å…¶å®åæ ‡è½´å°±æ˜¯ç”±è¿™äº›ä¸œè¥¿æ„æˆçš„ã€‚
							.attr("class", "node") //attrè®¾ç½®htmlå±æ€§ï¼Œstyleè®¾ç½®csså±æ€§
							.attr(
									"transform",
									function(d) {
										return "translate(" + source.y0 + ","
												+ source.x0 + ")";
									}).on("click", click);

							//æ·»åŠ è¿æ¥ç‚¹---æ­¤å¤„è®¾ç½®çš„æ˜¯åœ†åœˆè¿‡æ¸¡æ—¶å€™çš„æ•ˆæœï¼ˆé¢œè‰²ï¼‰
							// nodeEnter.append("circle")
							//   .attr("r", 1e-6)
							//   .style("fill", function(d) { return d._children ? "lightsteelblue" : "#357CAE"; });//d ä»£è¡¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸æŸå…ƒç´ ç»‘å®šçš„æ•°æ®ã€‚
							nodeEnter.append("rect").attr("x", -23).attr("y",
									-10).attr("width", 70).attr("height", 22)
									.attr("rx", 10).style("fill", "#357CAE"); //d ä»£è¡¨æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸æŸå…ƒç´ ç»‘å®šçš„æ•°æ®ã€‚

							//æ·»åŠ æ ‡ç­¾
							nodeEnter.append("text").attr("x", function(d) {
								return d.children || d._children ? 13 : 13;
							}).attr("dy", "-4")
							// .attr("text-anchor", function(d) { return d.children || d._children ? "end" : "start"; })
							.attr("text-anchor", "middle").text(function(d) {
								return d.name;
							}).style("fill", "white").style("fill-opacity",
									1e-6);

							nodeEnter.append("line").attr("x1", "-25").attr(
									"y1", "0").attr("x2", "50").attr("y", "0")
									.attr("stroke", "white")

							nodeEnter.append("text").attr("x", function(d) {
								return d.children || d._children ? 13 : 13;
							}).attr("dy", "10").attr("text-anchor", "middle")
									.text(function(d) {
										return d.name;
									}).style("fill", "white").style(
											"fill-opacity", 1);
							// Transition nodes to their new position.å°†èŠ‚ç‚¹è¿‡æ¸¡åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®-----ä¸»è¦æ˜¯é’ˆå¯¹èŠ‚ç‚¹è¿‡æ¸¡è¿‡ç¨‹ä¸­çš„è¿‡æ¸¡æ•ˆæœ
							//nodeå°±æ˜¯ä¿ç•™çš„æ•°æ®é›†ï¼Œä¸ºåŸæ¥æ•°æ®çš„å›¾å½¢æ·»åŠ è¿‡æ¸¡åŠ¨ç”»ã€‚é¦–å…ˆæ˜¯æ•´ä¸ªç»„çš„ä½ç½®
							var nodeUpdate = node.transition() //å¼€å§‹ä¸€ä¸ªåŠ¨ç”»è¿‡æ¸¡
							.duration(duration) //è¿‡æ¸¡å»¶è¿Ÿæ—¶é—´,æ­¤å¤„ä¸»è¦è®¾ç½®çš„æ˜¯åœ†åœˆèŠ‚ç‚¹éšæ–œçº¿çš„è¿‡æ¸¡å»¶è¿Ÿ
							.attr("transform", function(d) {
								return "translate(" + d.y + "," + d.x + ")";
							});

							nodeUpdate.select("rect").attr("x", -23).attr("y",
									-10).attr("width", 70).attr("height", 22)
									.attr("rx", 10).style("fill", "#357CAE");

							nodeUpdate.select("text").attr("text-anchor",
									"middle").style("fill-opacity", 1);

							// Transition exiting nodes to the parent's new position.è¿‡æ¸¡ç°æœ‰çš„èŠ‚ç‚¹åˆ°çˆ¶æ¯çš„æ–°ä½ç½®ã€‚
							//æœ€åå¤„ç†æ¶ˆå¤±çš„æ•°æ®ï¼Œæ·»åŠ æ¶ˆå¤±åŠ¨ç”»
							var nodeExit = node.exit().transition().duration(
									duration).attr(
									"transform",
									function(d) {
										return "translate(" + source.y + ","
												+ source.x + ")";
									}).remove();

							// nodeExit.select("circle")
							//   .attr("r", 1e-6);
							nodeExit.select("rect").attr("x", -23).attr("y",
									-10).attr("width", 70).attr("height", 22)
									.attr("rx", 10).style("fill", "#357CAE");

							nodeExit.select("text").attr("text-anchor",
									"middle").style("fill-opacity", 1e-6);

							// Update the linksâ€¦çº¿æ“ä½œç›¸å…³
							//å†å¤„ç†è¿çº¿é›†åˆ
							var link = svg.selectAll("path.link").data(links,
									function(d) {
										return d.target.id;
									});

							// Enter any new links at the parent's previous position.
							//æ·»åŠ æ–°çš„è¿çº¿
							link.enter().insert("path", "g").attr("class",
									"link").attr("d", function(d) {
								var o = {
									x : source.x0,
									y : source.y0
								};
								return diagonal({
									source : o,
									target : o
								}); //diagonal - ç”Ÿæˆä¸€ä¸ªäºŒç»´è´å¡å°”è¿æ¥å™¨, ç”¨äºèŠ‚ç‚¹è¿æ¥å›¾.
							}).attr('marker-end', 'url(#arrow)');

							// Transition links to their new position.å°†æ–œçº¿è¿‡æ¸¡åˆ°æ–°çš„ä½ç½®
							//ä¿ç•™çš„è¿çº¿æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
							link.transition().duration(duration).attr("d",
									diagonal);

							// Transition exiting nodes to the parent's new position.è¿‡æ¸¡ç°æœ‰çš„æ–œçº¿åˆ°çˆ¶æ¯çš„æ–°ä½ç½®ã€‚
							//æ¶ˆå¤±çš„è¿çº¿æ·»åŠ è¿‡æ¸¡åŠ¨ç”»
							link.exit().transition().duration(duration).attr(
									"d", function(d) {
										var o = {
											x : source.x,
											y : source.y
										};
										return diagonal({
											source : o,
											target : o
										});
									}).remove();

							// Stash the old positions for transition.å°†æ—§çš„æ–œçº¿è¿‡æ¸¡æ•ˆæœéšè—
							nodes.forEach(function(d) {
								d.x0 = d.x;
								d.y0 = d.y;
							});
						}
						//æŠ˜å å‡½æ•°
						function click(d) {
							if (d.children) {
								d._children = d.children;
								d.children = null;
							} else {
								d.children = d._children;
								d._children = null;
							}
							update(d);
						}

					}
					/*-----------------------åˆå§‹åŒ–å‡½æ•°ç»“æŸ*------------------------*/

					// function check(nodes, find_name, may_need);
					// function add_tree(node, innerTree);
					//è‡ªå®šä¹‰jsoné•¿åº¦æŸ¥æ‰¾å‡½æ•°  
					function getJsonLength(jsonData) {
						var jsonLength = 0;
						for ( var item in jsonData) {
							//alert("Son is " + item);
							jsonLength++;
						}
						return jsonLength;
					}

					/*
					æ£€æŸ¥å‡½æ•°ï¼Œéå†ä¹‹å‰æ‰€æœ‰æ ‘çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰å¯¼å¸ˆçš„å­¦ç”Ÿä¹Ÿæ˜¯å¯¼å¸ˆçš„æƒ…å†µ
					
					 */
					//@nodes æºjsonæ ‘
					//@find_name è¦æ‰¾çš„å¯¼å¸ˆå
					//@may_need å¯èƒ½éœ€è¦æ·»åŠ çš„jsonæ ‘ 
					function check(nodes, find_name, may_need, keke) {
						var fanhui1 = 0;
						var fanhui2 = 1;
						alert("checkcheckcheckcheckcheckcheck");
						var length_now = getJsonLength(nodes.children);
						// alert("chang = " + length_now)
						for (var ll = 0; ll < length_now; ll++) {
							alert(nodes.children[ll].name);
							if (nodes.children[ll].name == find_name) {
								alert("hhhhhhhhhhhhhh");

								//add_tree(nodes.children[ll].children, may_need, keke);
								alert("add");
								alert(getJsonLength(may_need));
								nodes.children[ll] = may_need;
								alert("add success");
								return fanhui2;

							} else {
								check(nodes.children[ll], find_name, may_need,
										keke);
								//return;
							}
						}

						return fanhui1;
					}

					// function add_tree(node, innerTree, keke) {
					//     alert("add");
					//     node = innerTree;
					//     //treeData[]
					//     shuInit(keke);
					//     alert("add success");
					// }
					// //@ node èŠ‚ç‚¹æ·»åŠ 
					// //@ innerTree æ·»åŠ çš„å†…å®¹
					// function add_tree(node, innerTree) {
					//     alert("add");
					//     node.children = innerTree;
					// }

					//è¿½é€å‡½æ•°
					/*
					åˆ†å‰²ä¼ è¾“è¿‡æ¥çš„æ•°æ®å¹¶æ„é€ jsonæ ‘ç»“æ„
					 */
				                        function chase() {
					//	                                           alert("æŒ‰â€œç¡®è®¤â€ç”Ÿæˆå­¦æ ‘å“¦ï¼);
						//treeData.join("node");
						//alert(treeData[0].name);
						//treeData = [{}];
						// alert("Hello!!");
						// alert(treeData.name);
						// treeData.name = "Test";
						//update(source);
						// treeData[0].children[0].name = "sbbbbb";
						//console.log(treeData);
						var count = 0; //å®šä¹‰å„¿å­èŠ‚ç‚¹çš„ç¼–å·
						var flag = 0; //å®šä¹‰æ ‡å¿—æ˜¯å¦ä¸ºå…³è”æ ‘å€¼ä¸º1
						// var flag = 0;
						// var fflag = 0;
						// var daoshi = [];
						var all_data = document.getElementById("user").value;
						//alert(xx);
						var sclice_data = [];
						var model_data = [];

						model_data = all_data.split("\n\n");

						//ç”Ÿæˆæ ‘å‹ç»“æ„æ•°æ®
						for (var j = 0; j < model_data.length; ++j) {
							//åˆå§‹åŒ–å˜é‡
							count = 0;
							flag = 0;
							count_shu = 0
							//treeData[j] = [{}];
							//shuInit();
							sclice_data = model_data[j].split("\n");

							for (var i = 0; i < sclice_data.length; ++i) {
								var head_tmp = "";
								var body_tmp = "";
								//fflag = 0;

								var hb = sclice_data[i].split("ï¼š"); //ä»å†’å·åˆ†å‰²ä¸€å±‚å­—ç¬¦ä¸²
								head_tmp = hb[0];
								body_tmp = hb[1];
								//å¤„ç†å†’å·å‰çš„éƒ¨åˆ†
								if (head_tmp == "å¯¼å¸ˆ") {
									//document.write("<br /><br />"+body_tmp+"<br />");
									var daoshi2 = {
										"name" : body_tmp,
										"parent" : "null",
										"children" : [ {} ]
									}
									treeData[j] = daoshi2; //å°†å¯¼å¸ˆåµŒå…¥èŠ‚ç‚¹
									// console.log(treeData);
									//update(source);
									//å¼¹å‡ºå¯¼å¸ˆå
									//alert(treeData[j].name);

								} else {

									//document.write("<br />");
									var children = {
										"name" : head_tmp,
										"parent" : "null",
										"children" : [ {} ]
									}
									treeData[j].children[count] = children; //å°†å¹´çº§åŠèŒä¸šåµŒå…¥èŠ‚ç‚¹
									//å¼¹å‡ºå¹´çºªä»‹ç»
									//alert(treeData[j].children[count].name);
									//åˆ†å‰²2016çº§åšå£«ç”Ÿ
									// var heads = head_tmp.split("çº§");

									// treeData[j].children[count].name = heads[0] + "çº§";
									// console.log(treeData);
									// treeData[j].children[count].children[count].name = heads[1];
									// console.log(treeData);
									//document.write("å¹´çº§ï¼š"+heads[0]+"<br />");
									//document.write("èŒä¸šï¼š"+heads[1]+"<br />");
									//å¤„ç†å†’å·åçš„éƒ¨åˆ†
									var bodies = body_tmp.split("ã€");
									//document.write("å§“åï¼š");
									for (var kk = 0; kk < bodies.length; ++kk) {
										//document.write("|");
										//document.write(bodies[kk]+"|");	
										var children = {
											"name" : bodies[kk],
											"parent" : "null",
										//"children": [{}]
										}
										//treeData.push(children);
										treeData[j].children[count].children[kk] = children; //å°†å§“ååµŒå…¥èŠ‚ç‚¹
										//console.log(treeData);
										//å¼¹å‡ºå­¦ç”Ÿå
										//alert(treeData[j].children[count].children[kk].name);

									}
									count++; //ç¬¬äºŒå­èŠ‚ç‚¹ç¼–å·åŠ ä¸€ï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªç¬¬äºŒå­èŠ‚ç‚¹
								}
							}
							//ä¸€æ£µæ ‘å‹æ•°æ®æ„é€ å®Œæˆ
							//alert(treeData[j].length);
							//å’Œå‰é¢æ‰€æœ‰çš„æ ‘æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå…³è”æ ‘
							var tree_tmp = treeData[j];
							var name_tmp = treeData[j].name;
							for (num_tmp = 0; num_tmp < j; num_tmp++) {
								//alert("num: " + num_tmp);
								// alert("length = " + getJsonLength(treeData[num_tmp].children[0].children));
								// alert(treeData[num_tmp]);
								// alert(treeData[j].name);
								// alert(treeData[j]);
								flag = check(treeData[num_tmp], name_tmp,
										tree_tmp, num_tmp);
								alert("flag = " + flag);

								// alert(check(treeData[num_tmp], treeData[j].name, treeData[j]));
								// alert(test("hhhhhhhhhhhhh"));
							}
							if (!flag)
								count_shu++;

							//é‡æ–°ç”Ÿæˆæ ‘
							//shuInit(j);
							//update(source);
						}

						//ç”Ÿæˆæ‰€æœ‰æ ‘
						for (var i = 0; i <= count_shu; i++) {
							shuInit(i)
						}
					}

					//@nodes æºjsonæ ‘
					//@find_name è¦æ‰¾çš„å¯¼å¸ˆå
					//@may_need å¯èƒ½éœ€è¦æ·»åŠ çš„jsonæ ‘       
					//function check(nodes, find_name, may_need) {
					    // for (var ll = 0; ll < nodes.length; ll++) {
					        // if (nodes.children[i] == "null") {
					           //  if (nodes.name == find_name) {
					           //     add_tree(nodes, may_need);
					            //     return;
					          //   }
					         //  } else {
					         //    check(nodes.children[ll], find_name, may_need);
					         //    return;
					       //  }

					    // }
					// }
					// //@ node èŠ‚ç‚¹æ·»åŠ 
					// //@ innerTree æ·»åŠ çš„å†…å®¹
					// function add_tree(node, innerTree) {
					//     node.children = innerTree;
					// }
				</script>
				<h3  style="text-align:center;">Tips</h3>
				<h5 style="text-align:center;">â˜…è¾“å…¥ä¸åŒæ ‘ä¹‹å‰è¯·æ¸…é™¤æ–‡æœ¬æ¡† </h5>
                <h5 style="text-align:center;">â˜…æ¯æ£µæ ‘è¾“å…¥æ ¼å¼è§æ–‡æœ¬åŸŸæç¤ºå†…å®¹</h5>
                <h5 style="text-align:center;"style="color:white">â˜…ç‚¹å‡»èŠ‚ç‚¹å¯è¿›è¡Œç¼©æ”¾å“¦ï¼</h5>
				<textarea id="user" style="border:0px;background:#FFF0F5" cols="40" rows="7"
    placeholder="å¯¼å¸ˆï¼šå¼ ä¸‰
2016çº§åšå£«ç”Ÿï¼šå¤©ä¸€ã€ç‹äºŒã€å´äº”
2015çº§ç¡•å£«ç”Ÿï¼šæå››ã€ç‹äº”ã€è®¸å…­
2016çº§ç¡•å£«ç”Ÿï¼šåˆ˜ä¸€ã€æäºŒã€æä¸‰
2017çº§æœ¬ç§‘ç”Ÿï¼šåˆ˜å…­ã€çªä¸ƒã€å¸å››"></textarea>
	<button type="button" class="btn btn-primary" onClick="chase()">ç”Ÿæˆå®¶æ—æ ‘</button>

	
</body>
</html>